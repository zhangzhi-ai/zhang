# 注册功能调试指南

## 问题分析

根据当前的代码分析，注册功能可能存在以下问题：

### 1. CORS配置问题
- ✅ 已添加 `CORS_EXPOSE_HEADERS = ['X-Captcha-Key']`
- 这允许前端读取自定义响应头

### 2. 前端验证码获取
- ✅ 已修复 `refreshCaptcha` 函数
- 添加了错误处理和调试日志

### 3. 数据提交格式
- ✅ 已修复 `handleSubmit` 函数
- 正确构建 `submitData` 对象

## 调试步骤

### 步骤1：检查验证码API
1. 打开浏览器开发者工具（F12）
2. 访问注册页面：http://localhost:8080/register
3. 查看Network标签页
4. 点击验证码图片刷新
5. 检查 `/api/users/captcha/image/` 请求：
   - 状态码应该是200
   - Response Headers中应该有 `X-Captcha-Key`

### 步骤2：检查注册提交
1. 填写注册表单
2. 输入验证码（区分大小写）
3. 点击注册按钮
4. 查看Network标签页中的 `/api/users/register/` 请求：
   - 检查Request Payload是否包含所有必要字段
   - 检查Response内容

### 步骤3：检查后端日志
查看 `blog_project/logs/django.log` 文件中的错误信息

## 可能的解决方案

### 如果验证码图片不显示：
```bash
# 重启Django服务
cd blog_project
python manage.py runserver 0.0.0.0:8000
```

### 如果提示数据库错误：
```bash
# 运行数据库迁移
python manage.py makemigrations
python manage.py migrate
```

### 如果CORS错误：
确保Django服务运行在8000端口，前端运行在8080端口

## 测试用例

### 正常注册流程：
- 用户名：testuser123
- 手机号：13800138888  
- 邮箱：test@example.com
- 昵称：测试用户
- 密码：123456
- 确认密码：123456
- 验证码：（从图片中读取）

### 预期结果：
- 注册成功后显示"注册成功，请登录"
- 自动跳转到登录页面

## 常见错误及解决方法

### 1. "图片验证码错误或已过期"
- 确保验证码输入正确（区分大小写）
- 验证码有5分钟有效期
- 点击图片刷新验证码

### 2. "该用户名已被注册"
- 更换不同的用户名

### 3. "该手机号已被注册"  
- 更换不同的手机号

### 4. 网络请求失败
- 检查Django服务是否正常运行
- 检查端口配置是否正确

## 修复记录

### 已修复的问题：
1. ✅ 添加了 `CORS_EXPOSE_HEADERS` 配置
2. ✅ 修复了前端验证码获取逻辑
3. ✅ 修复了注册数据提交格式
4. ✅ 移除了短信验证码相关代码

### 当前状态：
- 后端API：正常
- 前端页面：正常显示
- 验证码功能：应该正常
- 注册提交：应该正常

如果仍有问题，请提供具体的错误信息或截图。